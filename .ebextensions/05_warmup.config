# 05_warmup.config - Pre-download EasyOCR models during deployment

container_commands:
  01_warmup_ocr:
    # This runs AFTER deployment, BEFORE serving traffic
    command: |
      # Activate the Python virtual environment that EB created
      source /var/app/venv/*/bin/activate

      # Run Python code to download and initialize EasyOCR models
      python -c "
      import easyocr
      import os

      print('='*60)
      print('PRE-DOWNLOADING EASYOCR MODELS...')
      print('='*60)

      # Create model directory in /tmp (writable location on EB)
      os.makedirs('/tmp/easyocr_models', exist_ok=True)

      try:
          # Initialize EasyOCR - this downloads models automatically
          reader = easyocr.Reader(
              ['en'],                                      # English language
              gpu=False,                                   # No GPU on basic instances
              download_enabled=True,                       # Allow downloading
              model_storage_directory='/tmp/easyocr_models'  # Where to save
          )
          print('✓ Models downloaded successfully!')
          print('✓ OCR reader initialized!')
      except Exception as e:
          print(f'✗ Error during warmup: {e}')

      print('='*60)
      "

    # Only run on the leader instance (if multiple instances)
    leader_only: true

    # Don't fail deployment if this fails (we'll initialize on first request as fallback)
    ignoreErrors: true